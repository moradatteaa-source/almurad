<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة التحكم - نظام المراد</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
font-family: 'Tajawal', sans-serif;
      display: flex;
      height: 100vh;
      background: #f8f9fb;
      overflow: hidden;
    }

    /* الشريط الجانبي */
    .sidebar {
      width: 260px;
      background-color: #043B64;
      color: white;
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .sidebar h2 {
      text-align: center;
      background-color: #FF6B2D;
      padding: 15px;
      margin: 0;
      font-size: 18px;
    }

    .menu-item {
      padding: 15px 20px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .menu-item:hover {
      background-color: rgba(255,255,255,0.1);
    }

    .submenu {
      background-color: #064b7a;
      display: none;
    }

    .submenu div {
      padding: 10px 40px;
      font-size: 14px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .submenu div:hover {
      background-color: rgba(255,255,255,0.15);
    }

    /* المحتوى */
    .content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      position: relative;
    }

    .header {
      font-size: 22px;
      color: #043B64;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .menu-toggle {
      display: none;
      font-size: 24px;
      background: none;
      border: none;
      color: #043B64;
      cursor: pointer;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
      gap: 20px;
    }

    .card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-3px);
    }

    .card h3 {
      color: #043B64;
      margin: 0;
    }

    .card p {
      color: #666;
      margin: 10px 0 0;
      font-weight: bold;
      font-size: 15px;
    }

    .logout {
      background: #FF6B2D;
      border: none;
      padding: 10px;
      color: white;
      border-radius: 6px;
      margin: 15px;
      cursor: pointer;
    }

    .logout:hover {
      opacity: 0.9;
    }

    @media (max-width: 768px) {
  .sidebar {
    position: fixed;
    top: 0;
    bottom: 0;
    right: 0;
    transform: translateX(100%);
  }

  .sidebar.active {
    transform: translateX(0);
  }

  .menu-toggle {
    display: block;
  }
}

/* ✅ الكود الجديد هنا */
h1, h2, h3, h4, h5, h6 {
  font-weight: 700;
}

p, div, span, button {
  font-weight: 500;
}

</style>

</head>
<body>

  <!-- الشريط الجانبي -->
  <div class="sidebar" id="sidebar">
    <h2>نظام المراد ⚙️</h2>

    <!-- 🟣 الطلبات -->
    <div class="menu-item" onclick="toggleMenu('ordersMenu')">📦 الطلبات</div>
    <div class="submenu" id="ordersMenu">
      <div onclick="openOrders('')">الطلبات الجديدة</div>
      <div onclick="openOrders('مثبت')">الطلبات المثبتة</div>
      <div onclick="openOrders('قيد المعالجة')">قيد المعالجة</div>
      <div onclick="openOrders('قيد التجهيز')">قيد التجهيز</div>
      <div onclick="openOrders('قيد التوصيل')">قيد التوصيل</div>
      <div onclick="openOrders('تم التسليم')">تم التسليم</div>
      <div onclick="openOrders('راجع')">الطلبات الراجعة</div>
      <div onclick="openOrders('رفض')">الطلبات المرفوضة</div>
      <div style="background:#FF6B2D;color:white;font-weight:bold;text-align:center;cursor:pointer" onclick="openNewOrder()">➕ إضافة طلب جديد</div>
    </div>

    <!-- 🟢 الحسابات -->
    <div class="menu-item" onclick="toggleMenu('financeMenu')">💰 الحسابات</div>
    <div class="submenu" id="financeMenu">
      <div>المبيعات</div>
      <div>الأرباح</div>
    </div>

    <!-- 📊 الإحصائيات -->
    <div class="menu-item" onclick="openStatistics()">📊 الإحصائيات</div>
    <!-- 👥 إدارة المستخدمين (تظهر فقط للأدمن) -->
<div class="menu-item" id="usersMenu" style="display:none;" onclick="openUsers()">👥 إدارة المستخدمين</div>


    <!-- 🚪 تسجيل الخروج -->
    <button class="logout" onclick="logout()">🚪 تسجيل الخروج</button>
  </div>

  <!-- المحتوى -->
  <div class="content">
<div class="header">
  <span id="sectionTitle">لوحة التحكم الرئيسية</span>
  <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
</div>

<span id="userDisplay" style="font-size:16px; color:#555;"></span>


    <div class="stats" id="statsContainer">
      <div class="card" data-status=""><h3>الطلبات الجديدة</h3><p id="newCount">0</p></div>
      <div class="card" data-status="مثبت"><h3>الطلبات المثبتة</h3><p id="fixedCount">0</p></div>
      <div class="card" data-status="قيد المعالجة"><h3>قيد المعالجة</h3><p id="processingCount">0</p></div>
      <div class="card" data-status="قيد التجهيز"><h3>قيد التجهيز</h3><p id="packingCount">0</p></div>
      <div class="card" data-status="قيد التوصيل"><h3>قيد التوصيل</h3><p id="deliveringCount">0</p></div>
      <div class="card" data-status="تم التسليم"><h3>تم التسليم</h3><p id="deliveredCount">0</p></div>
      <div class="card" data-status="راجع"><h3>راجع</h3><p id="returnedCount">0</p></div>
      <div class="card" data-status="رفض"><h3>رفض</h3><p id="rejectedCount">0</p></div>
      <!-- 🟠 إضافة طلب جديد -->
      <div class="card" id="card-add" style="background:#FF6B2D;color:white;">
        <h3>➕ إضافة طلب جديد</h3>
        <p>إنشاء طلب جديد</p>
      </div>
    </div>
  </div>
  

  <!-- 🔹 سكربت -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDtEJYJrmyP45qS2da8Cuc6y6Jv5VD0Uhc",
      authDomain: "almurad-system.firebaseapp.com",
      databaseURL: "https://almurad-system-default-rtdb.firebaseio.com/",
      projectId: "almurad-system",
      storageBucket: "almurad-system.appspot.com",
      messagingSenderId: "911755824405",
      appId: "1:911755824405:web:2bfbd18ddcf038ca48ad1c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const user = localStorage.getItem("loggedInUser");
    // ✅ عرض زر إدارة المستخدمين فقط إذا كان الأدمن
if (user === "admin") {
  document.getElementById("usersMenu").style.display = "block";
}

    if (!user) window.location.href = "index.html";

    // تحميل الإحصائيات السريعة
    async function loadStats() {
      const dbRef = ref(db);
      const snapshot = await get(child(dbRef, "orders"));
      if (!snapshot.exists()) return;

      const ordersData = snapshot.val();
      const orders = Object.values(ordersData);

      const counts = {
        "": 0,
        "مثبت": 0,
        "قيد المعالجة": 0,
        "قيد التجهيز": 0,
        "قيد التوصيل": 0,
        "تم التسليم": 0,
        "راجع": 0,
        "رفض": 0
      };

      orders.forEach(o => {
        const st = (o.status || "").trim();
        if (counts.hasOwnProperty(st)) counts[st]++;
        else if (!st) counts[""]++;
      });

      document.getElementById("newCount").textContent = counts[""];
      document.getElementById("fixedCount").textContent = counts["مثبت"];
      document.getElementById("processingCount").textContent = counts["قيد المعالجة"];
      document.getElementById("packingCount").textContent = counts["قيد التجهيز"];
      document.getElementById("deliveringCount").textContent = counts["قيد التوصيل"];
      document.getElementById("deliveredCount").textContent = counts["تم التسليم"];
      document.getElementById("returnedCount").textContent = counts["راجع"];
      document.getElementById("rejectedCount").textContent = counts["رفض"];
    }

    function openOrders(status) {
      window.location.href = `orders.html?status=${encodeURIComponent(status)}`;
    }

    function openNewOrder() {
      window.location.href = "add-order.html";
    }

    function openStatistics() {
      window.location.href = "statistics.html"; // ✅ فتح صفحة الإحصائيات مباشرة
    }

    function toggleMenu(id) {
      const submenu = document.getElementById(id);
      submenu.style.display = submenu.style.display === "block" ? "none" : "block";
    }

    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("active");
    }

    function logout() {
      localStorage.removeItem("loggedInUser");
      window.location.href = "index.html";
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadStats();

      const cards = document.querySelectorAll(".card[data-status]");
      cards.forEach(card => {
        card.addEventListener("click", () => {
          const status = card.getAttribute("data-status") || "";
          openOrders(status);
        });
      });

      const addBtn = document.getElementById("card-add");
      if (addBtn) addBtn.addEventListener("click", openNewOrder);
    });
// ✅ استرجاع المستخدم الحالي
const loggedUser = JSON.parse(localStorage.getItem("loggedInUser"));
if (!loggedUser) window.location.href = "index.html";

// 👋 عرض الاسم
document.getElementById("userDisplay").textContent = `👋 مرحباً، ${loggedUser.user || loggedUser.username}`;

// 🧩 الصلاحيات
const roles = loggedUser.roles || [];

// 🎯 عناصر القائمة
const ordersMenu   = document.querySelector(".menu-item[onclick*='ordersMenu']");
const financeMenu  = document.querySelector(".menu-item[onclick*='financeMenu']");
const statsMenu    = document.querySelector(".menu-item[onclick*='openStatistics']");
const usersMenu    = document.getElementById("usersMenu");
const storeMenu    = document.querySelector(".menu-item[onclick*='openStore']");
const settingsMenu = document.querySelector(".menu-item[onclick*='openSettings']");

// إخفاء الكل بالبداية
if (ordersMenu) ordersMenu.style.display = "none";
if (financeMenu) financeMenu.style.display = "none";
if (statsMenu) statsMenu.style.display = "none";
if (usersMenu) usersMenu.style.display = "none";
if (storeMenu) storeMenu.style.display = "none";
if (settingsMenu) settingsMenu.style.display = "none";

// 🟢 الأقسام المفتوحة للجميع
if (storeMenu) storeMenu.style.display = "block";      // إدارة المخزن
if (settingsMenu) settingsMenu.style.display = "block"; // الإعدادات

// 🟠 الأقسام حسب الصلاحيات
if (roles.includes("admin")) {
  if (ordersMenu) ordersMenu.style.display = "block";
  if (financeMenu) financeMenu.style.display = "block";
  if (statsMenu) statsMenu.style.display = "block";
  if (usersMenu) usersMenu.style.display = "block";
}
if (roles.includes("stabilizer")) {
  if (ordersMenu) ordersMenu.style.display = "block";
}
if (roles.includes("accountant")) {
  if (financeMenu) financeMenu.style.display = "block";
}
if (roles.includes("delivery")) {
  if (statsMenu) statsMenu.style.display = "block";
}
if (roles.includes("store")) {
  if (ordersMenu) ordersMenu.style.display = "block";
}

    window.toggleMenu = toggleMenu;
    window.toggleSidebar = toggleSidebar;
    window.openOrders = openOrders;
    window.openNewOrder = openNewOrder;
    window.openStatistics = openStatistics;
    window.logout = logout;
    function openUsers() {
  window.location.href = "users.html";
}
window.openUsers = function() {// 👋 عرض الاسم
const loggedUser = JSON.parse(localStorage.getItem("loggedInUser"));
if (loggedUser && loggedUser.user) {
  document.getElementById("userDisplay").textContent = `👋 أهلاً ${loggedUser.user}!`;
}
  window.location.href = "users.html";
};


// ⚡ نظام العبارات التحفيزية اليومية (بدون مكتبة خارجية)
function loadMotivationalQuote() {
  const quotes = [
    "ابدأ يومك بإيمانك بنفسك، فكل خطوة صغيرة نحو هدفك تقربك من النجاح الكبير.",
    "حين تظن أن الطريق انتهى، تذكّر أن الناجحين صنعوا طريقهم عندما لم يجدوا طريقًا أصلًا.",
    "لا تنتظر الظروف لتتحسن، بل كن أنت السبب في تحسينها. فالفرص تُخلق لا تُنتظر.",
    "العمل الجاد اليوم هو ما يجعل غدك مختلفًا عن البقية. اجعل كل يوم خطوة نحو أحلامك.",
    "النجاح لا يُقاس بما وصلت إليه، بل بما تغلبت عليه لتصل إلى هناك.",
    "لا تخف من البدايات الصغيرة، فكل إنجاز عظيم بدأ بخطوة متواضعة وشغف لا ينطفئ.",
    "الإنجاز لا يحتاج معجزة، فقط قلب لا يعرف الاستسلام وعقل يؤمن بالحلول.",
    "التحديات ليست عوائق، بل فرص لتُظهر قوتك وقدرتك على التميز.",
    "كن مثل النخلة، تُرمى بالحجارة فتعطي أطيب الثمار. اجعل صعوباتك دافعًا لا حاجزًا.",
    "ما تزرعه من جهد اليوم، ستحصده غدًا نجاحًا يملأ حياتك فخرًا وسعادة.",
    "لا تستهين بأي إنجاز، فكل خطوة نحو الأفضل هي نصرٌ على التردد والكسل.",
    "كل صباح هو فرصة جديدة لتثبت أنك قادر على أن تكون أفضل من الأمس.",
    "الثقة بالنفس لا تعني أنك الأفضل، بل أنك لا تقارن نفسك بأحد.",
    "الطموح هو الوقود الذي يجعل الأيام الصعبة مجرد مراحل في طريق النجاح.",
    "لا تنظر للقمم من بعيد، اصعد بخطوات ثابتة، وستصل عاجلاً أم آجلاً.",
    "الفشل ليس عدوك، بل معلمك الذي يدفعك لتتعلم كيف تصل بشكلٍ أقوى."
  ];

  // 🧠 اختيار حكمة عشوائية
  const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];

  // 💾 حفظ آخر حكمة لعدم تكرارها مباشرة
  localStorage.setItem("lastQuote", randomQuote);

  // 🎨 إنشاء مربع العرض البرتقالي
  const quoteBox = document.createElement("div");
  quoteBox.innerHTML = `<strong>💬 ${randomQuote}</strong>`;
  quoteBox.id = "quoteBox";
  quoteBox.style.background = "#FF6B2D";
  quoteBox.style.color = "white";
  quoteBox.style.padding = "16px";
  quoteBox.style.margin = "18px 0";
  quoteBox.style.borderRadius = "10px";
  quoteBox.style.textAlign = "center";
  quoteBox.style.fontWeight = "bold";
  quoteBox.style.fontSize = "16px";
  quoteBox.style.lineHeight = "1.8";
  quoteBox.style.direction = "rtl";
  quoteBox.style.boxShadow = "0 3px 10px rgba(0,0,0,0.15)";
  quoteBox.style.animation = "fadeIn 1.5s ease";
  quoteBox.style.transition = "transform 0.8s ease";
  quoteBox.style.transform = "translateY(10px)";
  setTimeout(() => (quoteBox.style.transform = "translateY(0)"), 100);

  const header = document.getElementById("userDisplay");
  if (header) {
    const old = document.getElementById("quoteBox");
    if (old) old.remove();
    header.after(quoteBox);
  }
}

// 🚀 تنفيذ تلقائي عند الدخول للوحة التحكم
loadMotivationalQuote();

  </script>

</body>
</html>
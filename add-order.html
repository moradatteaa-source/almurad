<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>â• Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø¯</title>
  <style>
    body {font-family: Tahoma, Arial; background: #f4f6fa; margin: 0;}
    header {background: #043B64; color: white; text-align: center; padding: 15px; font-size: 20px;}
    .container {
      max-width: 800px; margin: 30px auto; background: white;
      border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); padding: 25px;
    }
    .row {display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;}
    .field {flex: 1; min-width: 230px; display: flex; flex-direction: column;}
    label {font-weight: bold; margin-bottom: 4px; color: #043B64;}
    input, textarea, select {
      padding: 8px; border: 1px solid #ccc; border-radius: 6px;
      font-size: 14px; width: 100%;
    }
    textarea {resize: vertical; height: 70px;}
    button {
      background: #FF6B2D; color: white; border: none; border-radius: 8px;
      padding: 10px 20px; cursor: pointer; font-size: 15px; margin-top: 15px;
    }
    button:hover {opacity: 0.9;}
    #savedMsg {color: green; font-size: 13px; margin-top: 5px; display: none;}
    .dropdown-input {position: relative;}
    .dropdown-list {
      position: absolute; top: 100%; right: 0; width: 100%;
      background: #fff; border: 1px solid #ccc; border-radius: 6px;
      max-height: 180px; overflow-y: auto; z-index: 1000; display: none;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .dropdown-item {
      padding: 6px 8px; cursor: pointer; font-size: 13px;
    }
    .dropdown-item:hover {background: #f0f0f0;}
  </style>
</head>
<body>

  <header>â• Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø¯</header>

  <div class="container">
    <div class="row">
      <div class="field"><label>Ø§Ù„ÙƒÙˆØ¯:</label><input id="code" type="text"></div>
      <div class="field"><label>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„:</label><input id="phone" type="text"></div>
      <div class="field"><label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ:</label><input id="phone2" type="text"></div>
    </div>

    <div class="row">
      <div class="field"><label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</label><div id="city"></div></div>
      <div class="field"><label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</label><div id="area"></div></div>
    </div>

    <div class="field"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„:</label><textarea id="address"></textarea></div>

    <div class="row">
      <div class="field"><label>Ø§Ù„Ø³Ø¹Ø±:</label><input id="price" type="number"></div>
      <div class="field"><label>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹:</label><input id="qty" type="number"></div>
    </div>

    <div class="field"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label><div id="product"></div></div>
    <div class="field"><label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label><textarea id="note"></textarea></div>

    <div class="row">
      <div class="field">
        <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label>
        <select id="status">
          <option value="">Ø¬Ø¯ÙŠØ¯</option>
          <option>Ù…Ø«Ø¨Øª</option>
          <option>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
          <option>Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</option>
          <option>Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„</option>
          <option>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
          <option>Ø±Ø§Ø¬Ø¹</option>
          <option>Ø±ÙØ¶</option>
        </select>
      </div>
      <div class="field"><label>Ø§Ù„Ù…Ø¹Ù„Ù†:</label><input id="advertiser" type="text"></div>
    </div>

    <div id="savedMsg">âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­</div>
    <button id="saveBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨</button>
    <button id="backBtn" style="background:#043B64;">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
    import { citiesData, allCities } from "./citiesData.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDtEJYJrmyP45qS2da8Cuc6y6Jv5VD0Uhc",
      authDomain: "almurad-system.firebaseapp.com",
      projectId: "almurad-system",
      storageBucket: "almurad-system.appspot.com",
      messagingSenderId: "911755824405",
      appId: "1:911755824405:web:2bfbd18ddcf038ca48ad1c"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ğŸ”½ Ø¯Ø§Ù„Ø© Ø¹Ø§Ù…Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
    function createDropdown(options, placeholder, onSelect) {
      const container = document.createElement("div");
      container.className = "dropdown-input";

      const input = document.createElement("input");
      input.type = "text";
      input.placeholder = placeholder;
      input.autocomplete = "off";

      const list = document.createElement("div");
      list.className = "dropdown-list";

      options.forEach(opt => {
        const item = document.createElement("div");
        item.className = "dropdown-item";
        item.textContent = opt;
        item.onclick = () => {
          input.value = opt;
          list.style.display = "none";
          onSelect(opt);
        };
        list.appendChild(item);
      });

      input.onfocus = () => list.style.display = "block";
      input.oninput = e => {
        const val = e.target.value.trim();
        Array.from(list.children).forEach(item => {
          item.style.display = item.textContent.includes(val) ? "block" : "none";
        });
      };

      document.addEventListener("click", e => {
        if (!container.contains(e.target)) list.style.display = "none";
      });

      container.appendChild(input);
      container.appendChild(list);
      return container;
    }

    let allProducts = [];
    async function loadProducts() {
      const snap = await getDocs(collection(db, "products"));
      allProducts = snap.docs.map(d => d.data().name);
    }

    // ğŸ”¹ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
    function setupDropdowns() {
      const cityDiv = document.getElementById("city");
      const areaDiv = document.getElementById("area");
      const productDiv = document.getElementById("product");

      const cityDropdown = createDropdown(allCities, "Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©", val => {
        const newAreas = citiesData[val] || [];
        areaDiv.innerHTML = "";
        const areaDropdown = createDropdown(newAreas, "Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©", () => {});
        areaDiv.appendChild(areaDropdown);
      });
      cityDiv.appendChild(cityDropdown);

      // Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ø¨Ø¯Ø¦ÙŠÙ‹Ø§ ÙØ§Ø¶ÙŠØ© Ù„ÙƒÙ† Ø¬Ø§Ù‡Ø²Ø©
      const areaDropdown = createDropdown([], "Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©", () => {});
      areaDiv.appendChild(areaDropdown);

      // Ø§Ù„Ù…Ù†ØªØ¬
      const productDropdown = createDropdown(allProducts, "Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬", () => {});
      productDiv.appendChild(productDropdown);
    }

    // ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
    document.getElementById("saveBtn").addEventListener("click", async () => {
      const order = {
        code: document.getElementById("code").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        phone2: document.getElementById("phone2").value.trim(),
        address: document.getElementById("address").value.trim(),
        city: document.querySelector("#city input")?.value || "",
        area: document.querySelector("#area input")?.value || "",
        price: Number(document.getElementById("price").value),
        qty: Number(document.getElementById("qty").value),
        product: document.querySelector("#product input")?.value || "",
        note: document.getElementById("note").value.trim(),
        status: document.getElementById("status").value,
        advertiser: document.getElementById("advertiser").value.trim(),
        created_at: new Date()
      };

      if (!order.phone || !order.product) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!");
        return;
      }

      await addDoc(collection(db, "orders"), order);
      const msg = document.getElementById("savedMsg");
      msg.style.display = "block";
      setTimeout(() => msg.style.display = "none", 2000);
    });

    document.getElementById("backBtn").onclick = () => window.location.href = "dashboard.html";

    await loadProducts();
    setupDropdowns();
  </script>

</body>
</html>
